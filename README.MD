
---

# ğŸ“˜ README â€” Backend Stock Manager (Express + Prisma + TypeScript Strict)

Ce guide explique **pas Ã  pas** comment installer, configurer et exÃ©cuter le backend de gestion de stock.

---

## ğŸš€ 1. PrÃ©requis

Assure-toi dâ€™avoir installÃ© :

* **Node.js** (â‰¥ 18)
* **npm** ou **yarn**
* **Docker + Docker Compose**
* **Git** (facultatif)

---

## ğŸ”§ 2. Installation du projet

Clone le projet puis installe les dÃ©pendances :

```bash
npm install
```

DÃ©pendances principales :

* Express
* Prisma + @prisma/client
* TypeScript strict
* bcryptjs, JWT, cors, dotenv
* WebSocket (optionnel pour notifications)

---

## ğŸ—„ 3. Configuration des variables dâ€™environnement

CrÃ©e un fichier `.env` Ã  la racine :

```env
DATABASE_URL="postgresql://postgres:password@localhost:5432/stockdb"
JWT_SECRET="supersecret"
NODE_ENV="development"
```

> Si tu utilises **Docker**, lâ€™URL PostgreSQL sera plutÃ´t :
> `postgresql://postgres:password@db:5432/stockdb`

---

## ğŸ§± 4. Lancer PostgreSQL + API (Docker Compose)

```bash
docker compose up --build
```

* PostgreSQL sera exposÃ© sur **5432**
* Backend sur **9000**

Le backend sera accessible Ã  :

```
http://localhost:9000
```

---

## ğŸ”„ 5. Initialiser Prisma

AprÃ¨s avoir lancÃ© PostgreSQL :

```bash
npx prisma migrate dev --name init
npx prisma generate
```

* **Migrate dev** : crÃ©e la base et applique le schÃ©ma Prisma
* **Generate** : gÃ©nÃ¨re le client Prisma pour TypeScript

---

## ğŸƒ 6. Lancer le serveur en dÃ©veloppement

```bash
npm run dev
```

Pour production :

```bash
npm run build
npm start
```

---

## ğŸ” 7. Authentification

### Enregistrement

**POST /auth/register**

```json
{
  "username": "admin",
  "password": "1234"
}
```

### Connexion

**POST /auth/login**

RÃ©ponse :

```json
{
  "message": "Login successful",
  "userId": 1,
  "token": "JWT_TOKEN_ICI"
}
```

> Le token est Ã  envoyer dans **Authorization: Bearer TOKEN** pour les routes protÃ©gÃ©es.

---

## ğŸ“¦ 8. Endpoints disponibles

### Marques (Brands)

* `GET /brands` â€” Liste toutes les marques
* `POST /brands` â€” CrÃ©e une nouvelle marque
* `DELETE /brands/:id` â€” Supprime une marque **et toutes ses piÃ¨ces + mouvements**

### PiÃ¨ces (Parts)

* `GET /parts` â€” Liste toutes les piÃ¨ces
* `POST /parts` â€” CrÃ©e une piÃ¨ce
* `PUT /parts/:id` â€” Met Ã  jour une piÃ¨ce
* `DELETE /parts/:id` â€” Supprime une piÃ¨ce **si aucun mouvement associÃ©** ou via transaction sÃ©curisÃ©e

### Mouvements (EntrÃ©e/Sortie)

* `GET /movements` â€” Liste tous les mouvements
* `GET /movements/by-part/:partId` â€” Liste les mouvements dâ€™une piÃ¨ce
* `POST /movements` â€” CrÃ©e un mouvement et met Ã  jour le stock automatiquement
* `DELETE /movements/:id` â€” Supprime un mouvement
* `DELETE /movements/freebd` â€” Supprime **tous les mouvements**

---

## âš¡ 9. Notes importantes

* **JWT** : utilisÃ© pour sÃ©curiser les routes. Le token peut Ãªtre stockÃ© dans **localStorage** ou **HTTP-only cookies**.
* **Transactions Prisma** : utilisÃ©es pour supprimer une marque et toutes ses piÃ¨ces/mouvements de maniÃ¨re sÃ©curisÃ©e.
* **TypeScript strict** : assure une sÃ©curitÃ© maximale cÃ´tÃ© backend.
* **WebSocket** : notifications temps rÃ©el pour stock/mouvements.

---

## ğŸŒ 10. DÃ©ploiement sur Render / Production

1. CrÃ©e un service **Web Service â†’ Node.js**
2. Ajoute un service **PostgreSQL**
3. Mets Ã  jour `DATABASE_URL` dans Render
4. Render lancera automatiquement :

```bash
npm install
npm run build
npm start
```

---

